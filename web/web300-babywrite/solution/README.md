#### BabyWrite

灵感来源于: 
[XNUCA 练习靶场 WEB login](https://www.jianshu.com/p/fd9f38753078)

常规使用 php 的文件包含功能读取题目源码
发现题目逻辑为

当登陆失败的时候会将用户名和密码写入日志文件
要攻击一个服务器，其实目的就是要让它能执行原本逻辑中不存在的代码
而这里有 php 的文件包含功能，其中所包含的参数前半部分可控（意味着我们可以控制协议）
前半部分可控，后半部分添加 .php 
由于 php 版本为 7.0 ，因此并不能通过使用空字节来截断打开的文件名（5.3以下版本有效）
因此需要我们控制协议，恰好在 php 所支持的协议中，phar 与 zip 等用于压缩文件的协议是存在以 .php 结尾这种情况的
那么我们只需要再能控制文件内容即可
这里的日志记录功能恰好给了我们控制文件内容的机会
但是这里的日志存在固定的格式，也就是

事实上这种情况抽象为了文件的开头结尾可控中间部分为一固定字符串，并且开头部分为文件名

> unix环境高级编程

![图片发自简书App](http://upload-images.jianshu.io/upload_images/2355077-e1ca7bb3e00f0bce.jpg)

前半部分不能存在空字符串和slash

现在我们只需要研究一下 phar 别的 php 所支持的压缩协议的文件格式 找出一个符合目前要求的压缩格式并构造一个压缩了 webshell 的压缩包即可

问题转换为：构造符合要求的用户名和密码使得写入的日志文件满足以下两个条件: 
1. 一个合法的压缩包
2. 压缩包的二进制格式中需要包含字符串 “ => ”，并且以这个字符串将压缩包分割为两部分
3. 第一部分需要被作为文件名使用，因此需要满足文件名的要求
4. 压缩包保存的文件中包含 webshell

---
提供两种思路: 
1. 膜拜[@一叶飘零](http://skysec.top/)大佬, 一个非预期解法, 打 call 打 call
> 构造 ZIP 文件


2. 预期思路
> 构造 Phar 文件

参考 php 文档对 phar 文件的说明

进行如下构造

成功后，将文件转换为应该提交的用户名和密码两个参数进行提交即可生成对应的日志文件
然后进行包含即可 getshell

---
#### BabyEval
Exploit: 
```
http://localhost/?str=${eval($_REQUEST[c])}&c=system('ls /');
```
